var X=XLSX;var XW={msg:"xlsx",rABS:"./lib/js-xlsx-master/xlsxworker2.js",norABS:"./lib/js-xlsx-master/xlsxworker1.js",noxfer:"./lib/js-xlsx-master/xlsxworker.js"};var wtf_mode=false;function fixdata(data){var o="",l=0,w=10240;for(;l<data.byteLength/w;++l){o+=String.fromCharCode.apply(null,new Uint8Array(data.slice(l*w,l*w+w)))}o+=String.fromCharCode.apply(null,new Uint8Array(data.slice(l*w)));return o}function ab2str(data){var o="",l=0,w=10240;for(;l<data.byteLength/w;++l){o+=String.fromCharCode.apply(null,new Uint16Array(data.slice(l*w,l*w+w)))}o+=String.fromCharCode.apply(null,new Uint16Array(data.slice(l*w)));return o}function s2ab(s){var b=new ArrayBuffer(s.length*2),v=new Uint16Array(b);for(var i=0;i!=s.length;++i){v[i]=s.charCodeAt(i)}return[v,b]}function xw_noxfer(data,cb){var worker=new Worker(XW.noxfer);worker.onmessage=function(e){switch(e.data.t){case"ready":break;case"e":console.error(e.data.d);break;case XW.msg:cb(JSON.parse(e.data.d));break}};var arr=rABS?data:btoa(fixdata(data));worker.postMessage({d:arr,b:rABS})}function xw_xfer(data,cb){var worker=new Worker(rABS?XW.rABS:XW.norABS);worker.onmessage=function(e){switch(e.data.t){case"ready":break;case"e":console.error(e.data.d);break;default:xx=ab2str(e.data).replace(/\n/g,"\\n").replace(/\r/g,"\\r");console.log("done");cb(JSON.parse(xx));break}};if(rABS){var val=s2ab(data);worker.postMessage(val[1],[val[1]])}else{worker.postMessage(data,[data])}}function xw(data,cb){transferable=document.getElementsByName("xferable")[0].checked;if(transferable){xw_xfer(data,cb)}else{xw_noxfer(data,cb)}}function enterSearch(e){if(e==13||e==32){search()}}function search(){var val=$("#search-val").val();if(val==null||val==""){show(getInitialData(),1,getInitialData().length);return}var res=[];for(var i=2;i<resultGlobal.length;i++){if(resultGlobal[i][1].indexOf(val)>-1){addArray(res,i)}}show(res,1,res.length)}function getFormatDate(formate){var res=formate;var time=new Date();res=res.replace("yy",time.getFullYear());res=res.replace("MM",time.getMonth()+1);res=res.replace("dd",time.getDate());res=res.replace("hh",time.getHours());res=res.replace("mm",time.getMinutes());res=res.replace("ss",time.getSeconds());return res}var selectList=[];function checkboxChanged(selector,index){if($(selector).is(":checked")){if(index==1){$("#current-table tbody").find("input").each(function(index,item){$(item).prop("checked",true);var selected=$(item).parent().find("label:eq(0)").text();addArray(selectList,Number(selected))})}else{addArray(selectList,index);if($("#current-table tbody").find("input").size()==selectList.length){$("#current-table thead").find("input:eq(0)").prop("checked",true)}}}else{if(index==1){$("#current-table tbody").find("input").each(function(index,item){$(item).prop("checked",false);var selected=$(item).parent().find("label:eq(0)").text();removeArray(selectList,Number(selected))})}else{removeArray(selectList,index);$("#current-table thead").find("input:eq(0)").prop("checked",false)}}$("#selected-number").text(selectList.length)}function containInArray(arr,val){for(var i=0;i<arr.length;i++){if(arr[i]==val){return true}}return false}function removeArray(arr,val){var isExist=false;for(var i=0;i<arr.length;i++){if(arr[i]==val){if(i!=arr.length){arr[i]=arr[arr.length-1]}isExist=true}}if(isExist){arr.length=arr.length-1}}function addArray(arr,val){if(!containInArray(arr,val)){arr.push(val)}}function downloadSelected(){download(selectList)}function downloadAll(){download(getInitialData())}function download(selected){var currentTimeFormate="dd.MM.yy hh:mm:ss";var currentTime=getFormatDate(currentTimeFormate);var content=";  EASE 4.0  Â© ADA\n;\n;  Exported on "+currentTime+'\n;\n;==================================\n;\n"FileType","Wall Materials"\n"Format",4.0\n"LengthUnit","m"\n;';for(var i=0;i<selected.length;i++){var data=resultGlobal[selected[i]];var MaterialName=data[1];content+='\n"MaterialName","'+MaterialName+'"\n';content+='"Description ","Totally Sound-Absorbing"\n';content+=';"Frequency  "';for(var j=8;j<resultGlobal[1].length;j++){var tmp=resultGlobal[1][j];tmp=tmp.substring(0,tmp.length-2);content+=",  "+tmp}content+='\n"Absorption  "';for(var j=8;j<data.length;j++){content+=","+data[j].trim()}content+="\n"}downloadFile("TestWMat.xwm",content)}function to_formulae(workbook){var result=[];workbook.SheetNames.forEach(function(sheetName){var formulae=X.utils.get_formulae(workbook.Sheets[sheetName]);if(formulae.length>0){result=formulae}});toTwoDimensionalArray(result);$("#starter").hide();show(getInitialData(),1,resultGlobal.length-2);$("#show-table").show();return result.join("\n")}var resultGlobal=[];function toTwoDimensionalArray(param){var tmp=[];var curRow=1;for(var i=0;i<param.length;i++){var conv=splitSpecStr(param[i]);if(curRow!=conv[0]){resultGlobal.push(tmp);tmp=[];curRow=conv[0]}tmp[conv[1]-1]=conv[2].replace(/[\r\n]/g,"")}resultGlobal.push(tmp);return resultGlobal}function splitSpecStr(str){var res=[];var pos=str.split("='")[0];res.push(Number(pos.substring(1,pos.length)));
res.push(pos.charCodeAt(0)-64);res.push(str.split("='")[1]);return res}function show(list,currentPage,countPerPage){var tHead="";var tContent="";var begin=(currentPage-1)*countPerPage;for(var i=begin;i<list.length&&i<begin+countPerPage;i++){var tmp=resultGlobal[list[i]];tContent+="<tr>";for(var j=0;j<tmp.length;j++){if(j==0){if(containInArray(selectList,list[i])){tContent+="<td><label class='sr-only'>"+list[i]+"</label><input type='checkbox' onchange='checkboxChanged(this, "+list[i]+");' checked> "+tmp[j]+"</td>"}else{tContent+="<td><label class='sr-only'>"+list[i]+"</label><input type='checkbox' onchange='checkboxChanged(this, "+list[i]+");'> "+tmp[j]+"</td>"}}else{tContent+="<td>"+tmp[j]+"</td>"}}tContent+="</tr>"}$("#current-table tbody").html(tContent)}function getInitialData(){var tmp=[];for(var i=0;i<resultGlobal.length-2;i++){tmp[i]=i+2}return tmp}function downloadFile(fileName,content){var aLink=document.createElement("a");var blob=new Blob([content]);var evt=document.createEvent("HTMLEvents");evt.initEvent("click",false,false);aLink.download=fileName;aLink.href=URL.createObjectURL(blob);aLink.dispatchEvent(evt)}function process_wb(wb){var output=to_formulae(wb)}var drop=document.getElementById("drop");function handleDrop(e){e.stopPropagation();e.preventDefault();var files=e.dataTransfer.files;var f=files[0];var reader=new FileReader();var name=f.name;reader.onload=function(e){var data=e.target.result;var arr=fixdata(data);var wb=X.read(btoa(arr),{type:"base64"});process_wb(wb)};reader.readAsArrayBuffer(f)}function handleDragover(e){e.stopPropagation();e.preventDefault();e.dataTransfer.dropEffect="copy"}if(drop.addEventListener){drop.addEventListener("dragenter",handleDragover,false);drop.addEventListener("dragover",handleDragover,false);drop.addEventListener("drop",handleDrop,false)}var xlf=document.getElementById("xlf");var testTmp;function handleFile(e){var files=e.target.files;var f=files[0];var reader=new FileReader();var name=f.name;reader.onload=function(e){var data=e.target.result;var arr=fixdata(data);var wb=X.read(btoa(arr),{type:"base64"});process_wb(wb)};reader.readAsArrayBuffer(f)}if(xlf.addEventListener){xlf.addEventListener("change",handleFile,false)};